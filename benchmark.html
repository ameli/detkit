


<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>Benchmark Tests &#8212; detkit Manual</title>
<script>
  document.documentElement.dataset.mode = localStorage.getItem("mode") || "auto";
  document.documentElement.dataset.theme = localStorage.getItem("theme") || "light"
</script>

  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=92025949c220c2e29695" rel="stylesheet">
<link href="_static/styles/pydata-sphinx-theme.css?digest=92025949c220c2e29695" rel="stylesheet">


  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/graphviz.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/css/custom-pydata.css" />
    <link rel="stylesheet" type="text/css" href="_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />

  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=92025949c220c2e29695">

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/sphinx_highlight.js"></script>
    <script src="_static/toggleprompt.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/js/custom-pydata.js"></script>
    <script src="_static/design-tabs.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>window.MathJax = {"tex2jax": {"inlineMath": [["\\(", "\\)"]], "displayMath": [["\\[", "\\]"]]}, "tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="_static/js/custom-pydata.css"></script>
    <link rel="shortcut icon" href="_static/favicon.ico"/>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <script defer data-domain="docs.scipy.org" src="https://views.scientific-python.org/js/script.js"></script>

    <!-- My custom JS -->
    <script type="text/javascript" src="../_static/js/custom-pydata.js"></script>

    <!-- Syntax highlighting for BibTex code blocks -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.23.0/themes/prism-solarizedlight.min.css"/>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.23.0/prism.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs-bibtex@2.0.1/prism-bibtex.min.js"></script>

    
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta name="docsearch:language" content="en">

  </head>
  
  
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="180" data-default-mode="auto">
    <div class="bd-header-announcement container-fluid" id="banner">
      

    </div>

    
    <nav class="bd-header navbar navbar-light navbar-expand-lg bg-light fixed-top bd-navbar" id="navbar-main"><div class="bd-header__inner container-xl">

  <div id="navbar-start">
    
    
  


<a class="navbar-brand logo" href="index.html">
  
  
  
  
    <img src="_static/images/icons/logo-detkit-light.png" class="logo__image only-light" alt="Logo image">
    <img src="_static/images/icons/logo-detkit-dark.png" class="logo__image only-dark" alt="Logo image">
  
  
</a>
    
  </div>

  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-collapsible" aria-controls="navbar-collapsible" aria-expanded="false" aria-label="Toggle navigation">
    <span class="fas fa-bars"></span>
  </button>

  
  <div id="navbar-collapsible" class="col-lg-9 collapse navbar-collapse">
    <div id="navbar-center" class="mr-auto">
      
      <div class="navbar-center-item">
        <ul id="navbar-main-elements" class="navbar-nav">
    <li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="install.html">
  1. Install
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="tests.html">
  2. Test
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="docker.html">
  3. Docker
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="api.html">
  API Reference
 </a>
</li>

    
</ul>
      </div>
      
    </div>

    <div id="navbar-end">
      
      <div class="navbar-end-item">
        <span id="theme-switch" class="btn btn-sm btn-outline-primary navbar-btn rounded-circle">
    <a class="theme-switch" data-mode="light"><i class="fas fa-sun"></i></a>
    <a class="theme-switch" data-mode="dark"><i class="far fa-moon"></i></a>
    <a class="theme-switch" data-mode="auto"><i class="fas fa-adjust"></i></a>
</span>
      </div>
      
      <div class="navbar-end-item">
        <form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form>
      </div>
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
        <li class="nav-item">
          <a class="nav-link" href="https://github.com/ameli/detkit" rel="noopener" target="_blank" title="GitHub"><span><i class="fab fa-github-square"></i></span>
            <label class="sr-only">GitHub</label></a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="https://pypi.org/project/detkit/" rel="noopener" target="_blank" title="PyPI"><span><i class="fab fa-python"></i></span>
            <label class="sr-only">PyPI</label></a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="https://anaconda.org/s-ameli/detkit" rel="noopener" target="_blank" title="Anaconda Cloud"><span><i class="fa fa-circle-notch"></i></span>
            <label class="sr-only">Anaconda Cloud</label></a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="https://hub.docker.com/r/sameli/detkit" rel="noopener" target="_blank" title="Docker Hub"><span><i class="fab fa-docker"></i></span>
            <label class="sr-only">Docker Hub</label></a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="https://mybinder.org/v2/gh/ameli/detkit/HEAD?filepath=notebooks%2FInterpolateTraceOfInverse.ipynb" rel="noopener" target="_blank" title="Lanuch Jupyter on Binder"><span><i class="fa fa-chart-line"></i></span>
            <label class="sr-only">Lanuch Jupyter on Binder</label></a>
        </li>
      </ul>
      </div>
      
    </div>
  </div>
</div>
    </nav>
    

    <div class="bd-container container-xl">
      <div class="bd-container__inner row">
          

<!-- Only show if we have sidebars configured, else just a small margin  -->
<div class="bd-sidebar-primary col-12 col-md-3 bd-sidebar">
  <div class="sidebar-start-items"><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <div class="bd-toc-item active">
    
    
    
  </div>
</nav>
  </div>
  <div class="sidebar-end-items">
  </div>
</div>


          


<div class="bd-sidebar-secondary d-none d-xl-block col-xl-2 bd-toc">
  
    
    <div class="toc-item">
      
<div class="tocsection onthispage mt-5 pt-1 pb-3">
    <i class="fas fa-list"></i> On this page
</div>

<nav id="bd-toc-nav">
    <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#test-functions">
   Test Functions
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#dataset">
   Dataset
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#configure-settings">
   Configure Settings
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#perform-benchmark-test">
   Perform Benchmark Test
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#run-on-cluster">
     Run on Cluster
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#output-files">
   Output Files
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#plot-results">
   Plot Results
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#references">
   References
  </a>
 </li>
</ul>

</nav>
    </div>
    
    <div class="toc-item">
      

<div class="tocsection editthispage">
    <a href="https://github.com/ameli/detkit/edit/main/docs/source/benchmark.rst">
        <i class="fas fa-pencil-alt"></i> Edit this page
    </a>
</div>

    </div>
    
  
</div>


          
          
          <div class="bd-content col-12 col-md-9 col-xl-7">
              
              <article class="bd-article" role="main">
                
  <section id="benchmark-tests">
<span id="benchmark"></span><h1>Benchmark Tests<a class="headerlink" href="#benchmark-tests" title="Permalink to this heading">#</a></h1>
<p>A numerical analysis on the performance of <span class="synco">detkit</span> functions is presented in Section 4 of <a class="footnote-reference brackets" href="#id6" id="id1" role="doc-noteref"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></a>. Here, we provide supplemental details on how to reproduce the numerical results of that reference.</p>
<p>This notebook plots the results that are produced by <a class="reference external" href="https://github.com/ameli/detkit/blob/main/benchmark/scripts/benchmark.py"><code class="docutils literal notranslate"><span class="pre">/detkit/benchmark/scripts/benchmark.py</span></code></a> script. The purpose of this script is to compare the presented method versus the conventional method of computing the determinant functions described below.</p>
<section id="test-functions">
<h2>Test Functions<a class="headerlink" href="#test-functions" title="Permalink to this heading">#</a></h2>
<p>Consider the matrices <span class="math notranslate nohighlight">\(\mathbf{A} \in \mathbb{R}^{n \times n}\)</span> and <span class="math notranslate nohighlight">\(\mathbf{X} \in \mathbb{R}^{n \times p}\)</span>. We compute  the matrix function</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{align}
    \mathrm{loggdet}(\mathbf{A}, \mathbf{X}) :=&amp; \mathrm{logdet}(\mathbf{A}) +  \mathrm{logdet}(\mathbf{X}^{\intercal} \mathbf{A}^{-1} \mathbf{X}), \tag{LD1}\\
    =&amp; \mathrm{logdet}(\mathbf{X}^{\intercal}  \mathbf{X}) + \mathrm{logdet}(\mathbf{N}), \tag{LD2}\\
    =&amp; \mathrm{logdet}(\mathbf{X}^{\intercal}  \mathbf{X}) + \mathrm{logdet}(\mathbf{U}_{\mathcal{X}^{\perp}}^{\intercal} \mathbf{A} \mathbf{U}_{\mathcal{X}^{\perp}}), \tag{LD3}
\end{align}\end{split}\]</div>
<p>where</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(\mathbf{N} = \mathbf{A} + \mathbf{P} - \mathbf{A}\mathbf{P}\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(\mathbf{P} = \mathbf{I} - \mathbf{X}(\mathbf{X}^{\intercal} \mathbf{X})^{-1} \mathbf{X}\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(\mathbf{M} = \mathbf{A}^{-1} - \mathbf{A}^{-1} \mathbf{X}(\mathbf{X}^{\intercal} \mathbf{A}^{-1} \mathbf{X})^{-1} \mathbf{X}^{\intercal} \mathbf{A}^{-1}\)</span>.</p></li>
<li><p><span class="math notranslate nohighlight">\(\mathbf{U}_{\mathcal{X}^{\perp}}\)</span> is the orthonormal basis that is orthogonal to the image of <span class="math notranslate nohighlight">\(\mathbf{X}\)</span>.</p></li>
</ul>
<p>The function <span class="math notranslate nohighlight">\(\mathrm{logdet}(\mathbf{A}, \mathbf{X})\)</span> is implemented by <a class="reference internal" href="generated/detkit.loggdet.html#detkit.loggdet" title="detkit.loggdet"><code class="xref py py-func docutils literal notranslate"><span class="pre">detkit.loggdet()</span></code></a>. To use either of the relations LD1, LD2, and LD3, the parameters <code class="docutils literal notranslate"><span class="pre">method=legacy</span></code>, <code class="docutils literal notranslate"><span class="pre">method=proj</span></code>, and <code class="docutils literal notranslate"><span class="pre">method=comp</span></code> can be passed to this function, respectively.</p>
<p>In our experiment, we <em>assume</em> both cases:</p>
<blockquote>
<div><ul class="simple">
<li><p><span class="math notranslate nohighlight">\(\mathbf{X}\)</span> is orthogonal.</p></li>
<li><p><span class="math notranslate nohighlight">\(\mathbf{X}\)</span> is not orthogonal.</p></li>
</ul>
</div></blockquote>
<p>We also <em>assume</em> both cases where</p>
<blockquote>
<div><ul class="simple">
<li><p><span class="math notranslate nohighlight">\(\mathbf{A}\)</span> is SPD.</p></li>
<li><p><span class="math notranslate nohighlight">\(\mathbf{A}\)</span> is not SPD.</p></li>
</ul>
</div></blockquote>
<p>The complexity of computing <span class="math notranslate nohighlight">\(\mathrm{logdet}(\mathbf{A}, \mathbf{X})\)</span> using either of LD1, LD2, or LD3 relations in the above is shown in the figure below (see also Figure 1 of <a class="footnote-reference brackets" href="#id6" id="id2" role="doc-noteref"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></a>).</p>
<a class="custom-dark reference internal image-reference" href="_images/loggdet-9-analytic-flops.svg"><img alt="_images/loggdet-9-analytic-flops.svg" class="custom-dark align-center" src="_images/loggdet-9-analytic-flops.svg" width="63%" /></a>
<p>In the benchmark test, we compare the process time and the empirical computational FLOPs of the relations LD1, LD2, and LD3.</p>
</section>
<section id="dataset">
<h2>Dataset<a class="headerlink" href="#dataset" title="Permalink to this heading">#</a></h2>
<p>In our experiment, the matrix <span class="math notranslate nohighlight">\(\mathbf{X}\)</span> is generated by <span class="math notranslate nohighlight">\(\sin(\omega x)\)</span> and <span class="math notranslate nohighlight">\(\cos(\omega x)\)</span> basis functions in the domain <span class="math notranslate nohighlight">\(x \in [0, 1]\)</span> and <span class="math notranslate nohighlight">\(\omega\)</span> is varied. This matrix can be generated by the function <a class="reference internal" href="generated/detkit.design_matrix.html#detkit.design_matrix" title="detkit.design_matrix"><code class="xref py py-func docutils literal notranslate"><span class="pre">detkit.design_matrix()</span></code></a>. We set the size <span class="math notranslate nohighlight">\(n \times p\)</span>. The ratio <span class="math notranslate nohighlight">\(p/n\)</span> is varied from <span class="math notranslate nohighlight">\(0, \cdots, 1\)</span> at <span class="math notranslate nohighlight">\(t=30\)</span> different ratios, while <span class="math notranslate nohighlight">\(n\)</span> is fixed. The columns of this matrix are orthogonalized.</p>
<p>Also, the matrix <span class="math notranslate nohighlight">\(\mathbf{A}\)</span> is obtained by <a class="reference internal" href="generated/detkit.covariance_matrix.html#detkit.covariance_matrix" title="detkit.covariance_matrix"><code class="xref py py-func docutils literal notranslate"><span class="pre">detkit.covariance_matrix()</span></code></a> function. The generated matrix is symmetric and positive-definite (SPD). This function generates the covariance matrix corresponding to the autocorrelation function of an electrocardiogram (ECG) signal <a class="footnote-reference brackets" href="#id7" id="id3" role="doc-noteref"><span class="fn-bracket">[</span>2<span class="fn-bracket">]</span></a> <a class="footnote-reference brackets" href="#id8" id="id4" role="doc-noteref"><span class="fn-bracket">[</span>3<span class="fn-bracket">]</span></a>. A part of the ECG signal is shown in the following figure using the code below:</p>
<img alt="_images/electrocardiogram.png" class="custom-dark align-center" src="_images/electrocardiogram.png" />
<p>The autocorrelation function corresponding to 30 seconds of the above signal is shown in Figure (a) below. Also, the corresponding covariance matrix is shown in Figure (c). Here we set the matrix size to <span class="math notranslate nohighlight">\(n = 2^9\)</span>. Figure (d) shows the eigenvalues of <span class="math notranslate nohighlight">\(\mathbf{A}\)</span>, indicating the matrix is positive-definite.</p>
<img alt="_images/covariance.png" class="custom-dark align-center" src="_images/covariance.png" />
<p>The above figure can be produced by the code below:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">detkit.datasets</span> <span class="kn">import</span> <span class="n">covariance_matrix</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">covariance_matrix</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">2</span><span class="o">**</span><span class="mi">9</span><span class="p">,</span> <span class="n">sample</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">cor</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ecg_start</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
<span class="go">                      ecg_end=30.0, ecg_wrap=True, plot=True)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The following numerical results are insensitive to the matrices used during the benchmark tests. Users can test the following benchmark test with randomly generated matrices.</p>
</div>
</section>
<section id="configure-settings">
<h2>Configure Settings<a class="headerlink" href="#configure-settings" title="Permalink to this heading">#</a></h2>
<p>The following numerical experiment consists of testing the code with two different implementations for Gramian matrix multiplications within the source code of this package. To do so, the source code should be configured and <span class="synco">detkit</span> needs to be compiled for each configuration as described below.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Note that a normal usage of <span class="synco">detkit</span> does not require compiling it from source.</p>
</div>
<p>First, obtain the source code of <span class="synco">detkit</span> by</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><style type="text/css">
span.prompt1:before {
  content: "$ ";
}
</style><span class="prompt1">git<span class="w"> </span>clone<span class="w"> </span>http://www.github.com/ameli/detkit</span>
</pre></div></div></div></blockquote>
<p>To configure the Gramian matrix multiplication, modify <a class="reference external" href="https://github.com/ameli/detkit/blob/main/detkit/_definitions/definitions.h"><code class="docutils literal notranslate"><span class="pre">/detkit/detkit/_definitions/definitions.h</span></code></a> file as follows:</p>
<ul class="simple">
<li><p>Set <code class="docutils literal notranslate"><span class="pre">USE_SYMMETRY</span></code> to <code class="docutils literal notranslate"><span class="pre">1</span></code> to use symmetry in Gramian matrix multiplication,</p></li>
<li><p>Set <code class="docutils literal notranslate"><span class="pre">USE_SYMMETRY</span></code> to <code class="docutils literal notranslate"><span class="pre">0</span></code> to not use symmetry in Gramian matrix multiplication.</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In <a class="reference external" href="https://github.com/ameli/detkit/blob/main/detkit/_definitions/definitions.h"><code class="docutils literal notranslate"><span class="pre">/detkit/detkit/_definitions/definitions.h</span></code></a> files, there are also other settings as follows:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">CHUNK_TASKS</span></code> should be set to <code class="docutils literal notranslate"><span class="pre">1</span></code>. If it is set to <code class="docutils literal notranslate"><span class="pre">0</span></code>, first, the process times become very oscillatory, and second, the FLOPs per unit matrix-multiplication task (<code class="docutils literal notranslate"><span class="pre">matmat</span></code> task) becomes a different number. For example, with chunk, the FLOP of <code class="docutils literal notranslate"><span class="pre">matmat</span></code> is near 5, and without it, it is 10.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">USE_OPENMP</span></code> should be set to <code class="docutils literal notranslate"><span class="pre">0</span></code> to properly compare both methods of LHS and RHS.</p></li>
</ul>
</div>
<p>For each of the above cases, compile the package as described in <a class="reference internal" href="install.html#compile"><span class="std std-ref">Compile from Source</span></a>, then run the experiment as described below.</p>
</section>
<section id="perform-benchmark-test">
<h2>Perform Benchmark Test<a class="headerlink" href="#perform-benchmark-test" title="Permalink to this heading">#</a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>To run the following tests, make sure the Linux <cite>perf tool</cite> is installed as described in <a class="reference internal" href="install.html#dependencies"><span class="std std-ref">Dependencies</span></a>. Note that the followings can only be tested on Linux.</p>
</div>
<p>The benchmark script is <a class="reference external" href="https://github.com/ameli/detkit/blob/main/benchmark/scripts/benchmark.py"><code class="docutils literal notranslate"><span class="pre">/detkit/benchmark/scripts/benchmark.py</span></code></a> file located at <a class="reference external" href="https://github.com/ameli/detkit/tree/main/benchmark"><code class="docutils literal notranslate"><span class="pre">/detkit/benchmark</span></code></a> directory of the source code. This script accepts some user arguments in the command line which can be found by inquiring its help by</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span class="prompt1"><span class="nb">cd</span><span class="w"> </span>detkit/benchmark/scripts</span>
<span class="prompt1">python<span class="w"> </span>./benchmark.py<span class="w"> </span>-h</span>
</pre></div></div><p>The above command prints the usage of the script as shown below:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>Usage: benchmark.py &lt;arguments&gt;

The following arguments are required:

    -n --size=[int]         Size of the matrix in log2. The size of matrix is 2
                            to the power of this number.
    -f --func=[str]         Type of function, which can be either &quot;loggdet&quot;, or
                            &quot;logpdet&quot;.

The following arguments are optional:

    -b --blas               Computes logdet using existing libraries in numpy
                            and scipy, otherwise, it uses the cython code.
    -r --repeat=[int]       Number of times the numerical experiment is
                            repeated. Default is 10.
    -t --num-ratios=[int]   Number of ratios (m/n) from 0 to 1 to be tested.
                            Default is 50.
    -v --verbose            Prints verbose output. Default is False.
    -h --help               Prints the help message.

Examples:

    1. Compute loggdet, set the matrix size to n=2**8=256, the array of 50
       ratios m/n from 0 to 1, i.e. linspace(0, 1, 50), and repeat each
       experiment 3 times:

       $ benchmark.py -n 8 -f loggdet -r 3 -t 50 -v

    2. Compute logpdet, set the matrix size to n=2**9=512, the array of 100
       ratios m/n from 0 to 1, i.e. linspace(0, 1, 100), and repeat each
       experiment 5 times:

       $ benchmark.py -n 9 -f logpdet -r 5 -t 100 -v
</pre></div>
</div>
<p>We run the script with <span class="math notranslate nohighlight">\(n = 2^9\)</span>, repeating the results by <span class="math notranslate nohighlight">\(r=10\)</span> times and generate <span class="math notranslate nohighlight">\(t = 30\)</span> data points in the interval for <span class="math notranslate nohighlight">\(p/n = 0, \cdots, 1\)</span>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span class="prompt1"><span class="nb">cd</span><span class="w"> </span>/detkit/benchmark/scripts</span>
<span class="prompt1">python<span class="w"> </span>./benchmark.py<span class="w"> </span>-n<span class="w"> </span><span class="m">9</span><span class="w"> </span>-f<span class="w"> </span>loggdet<span class="w"> </span>-r<span class="w"> </span><span class="m">10</span><span class="w"> </span>-t<span class="w"> </span><span class="m">30</span><span class="w"> </span>-v</span>
</pre></div></div><section id="run-on-cluster">
<h3>Run on Cluster<a class="headerlink" href="#run-on-cluster" title="Permalink to this heading">#</a></h3>
<p>To run the <a class="reference external" href="https://github.com/ameli/detkit/blob/main/benchmark/scripts/benchmark.py"><code class="docutils literal notranslate"><span class="pre">/detkit/benchmark/scripts/benchmark.py</span></code></a> script on a cluster, use the job files provided in <a class="reference external" href="https://github.com/ameli/detkit/tree/main/benchmark/jobfiles"><code class="docutils literal notranslate"><span class="pre">/detkit/benchmark/jobfiles</span></code></a> directory.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Run the benchmakr script on only one processor thread to produce accurate results.</p>
</div>
<ul>
<li><p>To run the experiment on a cluster with <cite>Torque</cite> workload manager, submit <a class="reference external" href="https://github.com/ameli/detkit/blob/main/benchmark/jobfiles/jobfile_benchmark.pbs"><code class="docutils literal notranslate"><span class="pre">/detkit/benchmark/jobfiles/jobfile_benchmark.pbs</span></code></a> job file by</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span class="prompt1"><span class="nb">cd</span><span class="w"> </span>/imate/benchmark/jobfiles</span>
<span class="prompt1">qsub<span class="w"> </span>jobfile_benchmark.pbs</span>
</pre></div></div></li>
<li><p>To run the experiment on a cluster with <cite>SLURM</cite> workload manager, submit <a class="reference external" href="https://github.com/ameli/detkit/blob/main/benchmark/jobfiles/jobfile_benchmark.sh"><code class="docutils literal notranslate"><span class="pre">/detkit/benchmark/jobfiles/jobfile_benchmark.sh</span></code></a> job file by</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span class="prompt1"><span class="nb">cd</span><span class="w"> </span>/imate/benchmark/jobfiles</span>
<span class="prompt1">sbatch<span class="w"> </span>jobfile_benchmark.sh</span>
</pre></div></div></li>
</ul>
<p>Before submitting the job, on either of the job Torque or SLURM files, make sure the followings are set: <code class="docutils literal notranslate"><span class="pre">N=9</span></code> (corresponding to <span class="math notranslate nohighlight">\(n = 2^9\)</span>), <code class="docutils literal notranslate"><span class="pre">NUM_RATIOS=30</span></code> (corresponding to <span class="math notranslate nohighlight">\(t=30\)</span>), <code class="docutils literal notranslate"><span class="pre">REPEAT=10</span></code> (corresponding to <span class="math notranslate nohighlight">\(r=10\)</span>). Also, set <code class="docutils literal notranslate"><span class="pre">FUNC=&quot;loggdet&quot;</span></code>, which computes <span class="math notranslate nohighlight">\(\mathrm{logdet}(\mathbf{A}, \mathbf{X})\)</span>.</p>
</section>
</section>
<section id="output-files">
<h2>Output Files<a class="headerlink" href="#output-files" title="Permalink to this heading">#</a></h2>
<p>The output of the above two experiments will be stored in <a class="reference external" href="https://github.com/ameli/detkit/tree/main/benchmark/pickle_results"><code class="docutils literal notranslate"><span class="pre">/detkit/benchmark/pickle_results</span></code></a> directory. Corresponding to each experiment, the output file is as follows:</p>
<blockquote>
<div><table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Output filename</p></th>
<th class="head"><p>function</p></th>
<th class="head"><p>matrix size</p></th>
<th class="head"><p>Gramian Matrix Multiplication</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">benchmark_loggdet_9_gram.pickle</span></code></p></td>
<td><p><span class="math notranslate nohighlight">\(\mathrm{loggdet}\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(n=2^9\)</span></p></td>
<td><p>with symmetry</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">benchmark_loggdet_9_no-gram.pickle</span></code></p></td>
<td><p><span class="math notranslate nohighlight">\(\mathrm{loggdet}\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(n=2^9\)</span></p></td>
<td><p>without symmetry</p></td>
</tr>
</tbody>
</table>
</div></blockquote>
</section>
<section id="plot-results">
<h2>Plot Results<a class="headerlink" href="#plot-results" title="Permalink to this heading">#</a></h2>
<p>Make sure the above <code class="docutils literal notranslate"><span class="pre">*.pickle</span></code> files are stored in <a class="reference external" href="https://github.com/ameli/detkit/tree/main/benchmark/pickle_results"><code class="docutils literal notranslate"><span class="pre">/detkit/benchmark/pickle_results</span></code></a> directory. To reproduce the plots, run the notebook file <a class="reference external" href="https://github.com/ameli/detkit/blob/main/benchmark/notebooks/benchmark_plot_draft_3.ipynb"><code class="docutils literal notranslate"><span class="pre">/detkit/benchmark/notebooks/benchmark_plot_draft_3.ipynb</span></code></a>. The notebook stores the plots as <cite>svg</cite> and <cite>pdf</cite> files in <a class="reference external" href="https://github.com/ameli/imate/blob/main/benchmark/plots"><code class="docutils literal notranslate"><span class="pre">/imate/benchmark/plots/</span></code></a> directory. These plots correspond to Figure 2 of <a class="footnote-reference brackets" href="#id6" id="id5" role="doc-noteref"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></a>, which is also shown below.</p>
<img alt="_images/loggdet-9-exp-flops-proc-time.svg" class="custom-dark align-center" src="_images/loggdet-9-exp-flops-proc-time.svg" /></section>
<section id="references">
<h2>References<a class="headerlink" href="#references" title="Permalink to this heading">#</a></h2>
<aside class="footnote-list brackets">
<aside class="footnote brackets" id="id6" role="note">
<span class="label"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></span>
<span class="backrefs">(<a role="doc-backlink" href="#id1">1</a>,<a role="doc-backlink" href="#id2">2</a>,<a role="doc-backlink" href="#id5">3</a>)</span>
<p>Ameli, S., and Shadden. S. C. (2022). <em>A Singular Woodbury and Pseudo-Determinant Matrix Identities and Application to Gaussian Process Regression</em> <a class="reference external" href="https://doi.org/10.48550/arXiv.2207.08038"><img alt="arXiv 2207.08038" src="https://img.shields.io/badge/arXiv-2207.08038-b31b1b.svg" /></a> <button class="btn btn-outline-info btn-sm btn-extra-sm" type="button" data-toggle="collapse" data-target="#collapse-bib1">
    BibTeX
</button> <button class="btn btn-outline-info btn-sm btn-extra-sm" type="button" id="showPDF01">
    PDF
</button></p>
<div class="highlight-BibTeX notranslate collapse" id="collapse-bib1">
<div class="highlight">
<pre class="language-bib">
<code class="language-bib">@misc{arxiv.2207.08038,
    doi = {10.48550/arXiv.2207.08038},
    author = {Ameli, S. and Shadden, S. C.},
    title = {A Singular Woodbury and Pseudo-Determinant Matrix Identities and Application to Gaussian Process Regression},
    year = {2022},
    archivePrefix={arXiv},
    eprint = {2207.08038},
    primaryClass={math.NA},
    howpublished={\emph{arXiv}: 2207.08038 [math.ST]},
}</code></pre>
</div>
</div></aside>
<aside class="footnote brackets" id="id7" role="note">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id3">2</a><span class="fn-bracket">]</span></span>
<p>Moody GB, Mark RG. The impact of the MIT-BIH Arrhythmia Database.
IEEE Eng in Med and Biol 20(3):45-50 (May-June 2001).
(PMID: 11446209); DOI: <a class="reference external" href="https://doi.org/10.13026/C2F305">10.13026/C2F305</a></p>
</aside>
<aside class="footnote brackets" id="id8" role="note">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id4">3</a><span class="fn-bracket">]</span></span>
<p>Goldberger AL, Amaral LAN, Glass L, Hausdorff JM, Ivanov PCh, Mark
RG, Mietus JE, Moody GB, Peng C-K, Stanley HE. PhysioBank,
PhysioToolkit, and PhysioNet: Components of a New Research Resource
for Complex Physiologic Signals. Circulation 101(23):e215-e220;
DOI: <a class="reference external" href="https://doi.org/10.1161/01.CIR.101.23.e215">10.1161/01.CIR.101.23.e215</a></p>
</aside>
</aside>
</section>
</section>


              </article>
              

              
              <footer class="bd-footer-article">
                  <!-- Previous / next buttons -->
<div class='prev-next-area'>
</div>
              </footer>
              
          </div>
          
      </div>
    </div>

  
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/pydata-sphinx-theme.js?digest=92025949c220c2e29695"></script>


    <!-- Adobe Embed API -->
    
    <script src="https://documentcloud.adobe.com/view-sdk/main.js"></script>


  </body>
</html>